---
title: 'Stat 579 - Homework #6'
date: "10/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Star Wars

FiveThirtyEight is a website founded by Statistician and writer Nate Silver to publish results from  opinion poll analysis, politics, economics, and sports blogging. 
One of the featured articles discusses [popularity of movies in the Star Wars Franchise](https://fivethirtyeight.com/features/americas-favorite-star-wars-movies-and-least-favorite-characters/)

This article is based on a survey collected by FiveThirtyEight and publicly available on github. Use the code below to read in the data from the survey:

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
starwars <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv")

# the following lines are necessary to fix the multibyte problem and make proper names
# part of the names:
line1 <- names(starwars)
line2 <- unlist(starwars[1,])
varnames <- paste(line1, line2)
# clean up some of the multibyte characters:
names(starwars) <- enc2native(stringi::stri_trans_general(varnames, "latin-ascii"))

starwars <- starwars[-1,]
head(starwars)
```



1. Download the RMarkdown file with these homework instructions to use as a template for your work.
Make sure to replace "Your Name" in the YAML with your name.

3. How many people responded to the survey? How many people have seen at least one of the movies? Use the variable `Have you seen any of the 6 films in the Star Wars franchise? Response` to answer this question. Only consider responses of participants who have seen at least one of the Star Wars films for the remainder of the homework.

```{r}
nrow(starwars)

starwars.yes <- starwars %>% 
  filter(`Have you seen any of the 6 films in the Star Wars franchise? Response` == "Yes")
nrow(starwars.yes)
```

- 1186 people responded to the servey.
- 936 people have seen at least one of the movies.

4. Variables `Gender Response` and `Age Response` are two of the demographic variables collected. Use `dplyr` to provide a frequency break down for each variable. Does the result surprise you? Comment. Reorder the levels in the variable `Age Response` from youngest to oldest.

```{r }
# reorder the levels in the variable `Age Response` from youngest to oldest.
starwars.yes <- starwars.yes %>% mutate(
  `Age Response` = as.factor(`Age Response`),
  `Age Response` = factor(`Age Response`, levels(`Age Response`)[c(2:4, 1)])
)

```


```{r}
starwars.yes %>% group_by(`Gender Response`) %>% summarise(n=n())

starwars.yes %>% group_by(`Age Response`) %>% summarise(n=n())


starwars.yes %>% ggplot(aes(x=`Gender Response`, fill=`Gender Response`)) +
  geom_bar()

starwars.yes %>% ggplot(aes(x=`Age Response`, fill=`Age Response`)) +
  geom_bar() +
  scale_fill_discrete(name="Age Response")
```

- According to the variable `Gender Response`, there are more males who responded to the survey.
- According to the variable `Age Response`, the age group 45-60 contains the most number of responders. However, the difference between different age groups is not that large. This is not a surprise for me since I know that Star Wars was especially popular in the age group of my parents' age (which is 45 - 60). It was really amazing at that time, and continuelly attracts people from different age groups. 

5. Variables 10 through 15 answer the question: "Please rank the Star Wars films in order of preference with 1 being your favorite film in the franchise and 6 being your least favorite film." for each of the films. 
Bring the data set into a long form. Introduce a variable for the star wars episode and the corresponding ranking. 
Find the average rank for each of the films. Are average ranks different between mens' and womens' rankings?
On how many responses are the averages based? Show these numbers together with the averages.

```{r}
library(tidyr)

episodeRank <- starwars.yes %>% 
  gather(key = episode, value = rank, 10:15, factor_key=T) %>% select(episode, rank, `Gender Response`)

levels(episodeRank$episode) <- c("Star Wars: Episode I  The Phantom Menace", 
                                 "Star Wars: Episode II  Attack of the Clones",
                                 "Star Wars: Episode III  Revenge of the Sith",
                                 "Star Wars: Episode IV  A New Hope",
                                 "Star Wars: Episode V The Empire Strikes Back",
                                 "Star Wars: Episode VI Return of the Jedi")

episodeRank <- episodeRank %>% mutate(
  rank = as.numeric(rank)
)

episodeRank %>% group_by(episode) %>% 
  summarise(
    average = mean(rank, na.rm = T),
    num_total = n(),
    num_response = sum(!is.na(rank)))

gen.avg <- episodeRank %>% group_by(`Gender Response`, episode) %>% 
  summarise(
    average = mean(rank, na.rm = T),
    num_total = n(),
    num_response = sum(!is.na(rank)))

gen.avg

gen.avg %>% filter(!is.na(`Gender Response`)) %>% group_by(episode) %>% 
  select(-num_total, -num_response) %>% 
  spread(key = `Gender Response`, value = average) %>% 
  mutate(diff = Female - Male)

```

- the average ranks for each of the films from episode I to episode VI are 3.73, 4.09, 4.34, 3.27, 2.51 and 3.05, respectively. And the averages are based on 835, 836, 835, 836, 836, and 836 responses, respectively.  
- The average ranks are slightly different between males and females, but not that much. The most disagreement appears at episode I and episode IV. Males like episode IV more than females, while females like episode I more than males.


6. R2 D2 or C-3P0? Which of these two characters is the more popular one? Use responses to variables 25 and 26 to answer this question. Note: first you need to define what you mean by  "popularity" based on the available data.

```{r}
char_score <- starwars.yes %>% select(25:26) %>% 
  mutate(
    c.fac = as.factor(`X25 C-3P0`),
    c.fac = factor(c.fac, levels(c.fac)[c(6, 3, 1, 2, 5, 4)]),
    r.fac = as.factor(`X26 R2 D2`),
    r.fac = factor(r.fac, levels(r.fac)[c(6, 3, 1, 2, 5, 4)]),
    c.num = as.numeric(c.fac),
    r.num = as.numeric(r.fac),
    C3P0 = ifelse(c.num == 6, NA, c.num),
    R2D2 = ifelse(r.num == 6, NA, r.num)
  ) %>% 
  gather(key=char, value=score, C3P0:R2D2) %>% 
  select(char, score)

char_score %>% group_by(char) %>% 
  summarise(
    num_total = n(),
    num_response = sum(!is.na(score)),
    average_score = mean(score, na.rm = T)
  )

```

- the popularity has 5 levels, so I assigned each level a score, where "Very favorably" has a score of 5. Based on this definition, we can see that R2D2 is a little bit more popular than C3P0.

7. Popularity contest: which of the surveyed characters is the most popular? use the popularity measure you defined in the previous question to evaluate responses for characters 16 through 29. Use an appropriate long form of the data to get to your answer. Visualize the result. 

```{r}
char_clct <- starwars.yes %>% 
  gather(key=char, value=score, 16:29) %>% select(char, score) %>% 
  mutate(
    char = as.factor(char)
  )
char_names <- c("X16 Han Solo", levels(char_clct$char)[-1])
levels(char_clct$char) <- substr(char_names, start = 5, stop = 100)


char_clct <- char_clct %>% mutate(
  score.fac = as.factor(score),
  score.fac = factor(score.fac, levels(score.fac)[c(6, 3, 1, 2, 5, 4)]),
  score.num = as.numeric(score.fac),
  score = ifelse(score.num == 6, NA, score.num)
) %>% select(char, score, score.fac)


# the results
char_clct %>% 
  mutate(
    char = reorder(char, -score, mean, na.rm = T)
  ) %>% group_by(char) %>% 
  summarise(
    num_total = n(),
    num_response = sum(!is.na(score)),
    average_score = mean(score, na.rm = T)
  )

# the score box plot
char_clct %>% 
  mutate(
    char = reorder(char, score, mean, na.rm = T)
  ) %>% 
  ggplot(aes(x=char, y=score)) +
  geom_boxplot() + coord_flip()

# bar chart of the characters
char_clct %>% 
  mutate(
    char = reorder(char, score, mean, na.rm = T)
  ) %>% filter(!is.na(score)) %>% 
  ggplot(aes(x=char, fill=score.fac)) +
  geom_bar(position = "stack") + coord_flip()


```

- According to my previous definiton, the most popular character is Han Solo, followed by Obi Wan Kenobi and Yoda.
- For the visualization, we can see that according to the box plot, Han Solo is more concentrated at 4 and 5, and according to the bar chart, it's also obvious that Han Solo has many 4 and 5. Obi Wan and Yoda have lower score probably because they have more votes for "very unfavorably" and "Somewhat unfavorably", which lower the mean score.


