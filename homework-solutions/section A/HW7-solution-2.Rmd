---
title: 'Stat 579 - Homework #7'
date: "10/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Human Development Index

The United Nations Development Programme publishes an annual report on human development across the globe. An interactive tool to visualize some of the data is available at  http://hdr.undp.org/en/data 



1. Download the RMarkdown file with these homework instructions to use as a template for your work.
Make sure to replace "Your Name" in the YAML with your name.
2. Download the data for 2018 from the left side tab  stating [Download 2018 Human Development Data Bank](http://hdr.undp.org/sites/default/files/2018_all_indicators.xlsx). This will lead you to an Excel document. Open it and comment on the structure you find in the `Data' sheet. Comment on the overall structure in the context of "long" versus "wide" data.

### This is a really big dataset. There are almost 26000 rows that detail 14 dimensions with 40+ indicators and up to 28 years of data. This is, by nature, untidy because there are separate variables for each year -- meaning that it is in wide format. In a long structure, there would be a separate row for each year.

3. There is an R package available online (on CRAN) that allows to read Excel files. Find the package, (install it if necessary), load it  and read the `Data' sheet "2018_all_indicators.xlsx" into R (make use of the available parameters). Compare the result in R with what is visible in Excel. Keep track of and comment on all steps in the process. 

### Package name -- 'openxlsx', install via CRAN. The two dataframes look pretty similar. 

```{r, cache = TRUE, warning = FALSE}
library(openxlsx)
hdi <- read.xlsx("2018_all_indicators.xlsx", sheet = 1, startRow = 1, colNames = TRUE)
head(hdi)
str(hdi)
```

For the write-up assume, that the Excel file is in the same folder as the homework Rmd file. Also assume, that both the TA and I have  updated versions of all packages you use, i.e. only load packages but do not install any in the code.
4. Bring the data into a long form. What setting do you use for missing values? How many indicators are in the data? Use `ggplot2` to show a barchart.

```{r, cache = TRUE, warning = FALSE}
library(tidyverse)

hdi_long <- hdi %>%
  gather(key=Year,value=HDI, c('1990':'2017')) %>% 
  filter(!is.na(HDI))

tail(hdi_long)

hdi_long %>% 
  group_by(indicator_name) %>% 
  summarise(n=n())

### There are 136 different indicators.

hdi_long %>% 
  ggplot(aes(x=indicator_name)) +
  geom_bar()
```

5. Two of the indicators are called `Human Development Index (HDI), male` and `Human Development Index (HDI), female`. Comment on this from a tidy data perspective.

### This data is not 'tidy' because a single column has information on multiple variables (HDI and gender). To truly tidy up this data, we should move Gender into its own column.


6. Use `tidyr` and `dplyr` functionality to get the data set into a format to be able to recreate the plot below (from the United Nations website) in ggplot. Use a classification of HDI of very high for [0.8,1], high for [0.7, .8), medium for [.55, .7) and low below .55), color lines by the last available year. 1pt of extra for using a better color scheme than is shown below.




```{r, cache = TRUE, warning = FALSE}
hdi_long <- hdi_long %>%
  filter(indicator_name == 'Human Development Index (HDI)') %>% 
  filter(!is.na(HDI)) %>% 
  mutate(threshold= ifelse(`9999` >= 0.8, "Very High", ifelse(`9999`>=0.7, "High", ifelse(`9999`>=0.55, "Medium", "Low"))))

head(hdi_long)

keeps <- c("country_name","Year", "HDI", "threshold", "9999")
hdi_long2 <- hdi_long[keeps]

hdi_long2$threshold <- factor(hdi_long2$threshold, levels=c("Low", "Medium", "High", "Very High"))


library(RColorBrewer)

hdi_long2 %>% 
  ggplot(aes(x=Year, y=HDI, group=country_name)) +
  geom_line(aes(color=threshold)) +
  scale_colour_brewer(palette = "RdBu", direction = -1) #+
  #theme_dark()

head(hdi_long2, 20)

### I chose this color scheme over gradient/sequential schemes because I thought that it was important to be able to see the outliers, or countries that suddenly jumped/fell in HDI over the years. With color schemes that are closer together, it is harder to capture those movements.
```

Due date: please refer to the website and Canvas for the due date. 

For the submission: submit your solution in an R Markdown file and (just for insurance) submit the corresponding html/word file with it. 
